<!DOCTYPE html>
<html>
<head>
    <title>Mini Expense Tracker</title>
</head>
<body>

<h2>Mini Expense Tracker</h2>

<label>Expense Title:</label><br>
<input type="text" id="title"><br><br>

<label>Amount:</label><br>
<input type="number" id="amount"><br><br>

<label>Date:</label><br>
<input type="date" id="date"><br><br>

<button onclick="addExpense()">Add Expense</button>
<button onclick="viewExpenses()">View Expenses</button>
<button onclick="deleteExpense()">Delete Expense</button>

<h3>Expense List:</h3>
<ul id="expenseList"></ul>

<script>

let db;

// ===============================
// Open IndexedDB Database
// ===============================
let request = indexedDB.open("ExpenseDB", 1);

request.onerror = function () {
    alert("Database failed to open");
};

request.onupgradeneeded = function (event) {
    db = event.target.result;

    if (!db.objectStoreNames.contains("expenses")) {
        db.createObjectStore("expenses", {
            keyPath: "id",
            autoIncrement: true
        });
    }
};

request.onsuccess = function (event) {
    db = event.target.result;
    viewExpenses(); // Load data on page load
};

// ===============================
// Add Expense
// ===============================
function addExpense() {

    let title = document.getElementById("title").value;
    let amount = document.getElementById("amount").value;
    let date = document.getElementById("date").value;

    if (!title || !amount || !date) {
        alert("Please fill all fields");
        return;
    }

    let transaction = db.transaction(["expenses"], "readwrite");

    transaction.onerror = function () {
        alert("Transaction error");
    };

    let store = transaction.objectStore("expenses");

    let expense = {
        title: title,
        amount: amount,
        date: date
    };

    let addRequest = store.add(expense);

    addRequest.onsuccess = function () {

        alert("Expense added successfully");

        // Clear input fields after success
        document.getElementById("title").value = "";
        document.getElementById("amount").value = "";
        document.getElementById("date").value = "";

        viewExpenses();
    };

    addRequest.onerror = function () {
        alert("Error adding expense");
    };
}

// ===============================
// View Expenses
// ===============================
function viewExpenses() {

    let transaction = db.transaction(["expenses"], "readonly");

    transaction.onerror = function () {
        alert("Transaction error");
    };

    let store = transaction.objectStore("expenses");

    let request = store.openCursor();

    let list = document.getElementById("expenseList");
    list.innerHTML = "";

    request.onsuccess = function (event) {

        let cursor = event.target.result;

        if (cursor) {

            let li = document.createElement("li");
            li.innerText =
                "ID: " + cursor.value.id +
                " | Title: " + cursor.value.title +
                " | Amount: " + cursor.value.amount +
                " | Date: " + cursor.value.date;

            list.appendChild(li);

            cursor.continue();
        }
    };

    request.onerror = function () {
        alert("Error fetching expenses");
    };
}

// ===============================
// Delete Expense
// ===============================
function deleteExpense() {

    let id = prompt("Enter Expense ID to delete:");

    if (!id) return;

    let transaction = db.transaction(["expenses"], "readwrite");

    transaction.onerror = function () {
        alert("Transaction error");
    };

    let store = transaction.objectStore("expenses");

    let deleteRequest = store.delete(Number(id));

    deleteRequest.onsuccess = function () {
        alert("Expense deleted successfully");
        viewExpenses();
    };

    deleteRequest.onerror = function () {
        alert("Error deleting expense");
    };
}

</script>

</body>
</html>